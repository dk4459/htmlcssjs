<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>네이버 지도 - 길찾기</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
    </script>
    <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=t0xruntwq5"></script>
    <!-- Geocoder 모듈용 -->
    <script src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=t0xruntwq5&submodules=geocoder"></script>
    <style>
        * {
            box-sizing: border-box;
        }

        #map {
            width: 68%;
            height: 447px;
            float: right;
            border: 1px solid #ddd;
            background: #f8f9fa;
            border-radius: 8px;
            margin-left: 10px;
        }

        #query {
            margin-left: 41px;
            margin-right: 5px;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        #results {
            width: 30%;
            margin-left: 20px;
            max-height: 500px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background: #f8f9fa;
        }

        #results .list-group-item {
            padding: 15px;
            border: none;
            border-bottom: 1px solid #ddd;
            transition: background-color 0.2s ease-in-out;
        }

        #results .list-group-item:last-child {
            border-bottom: none;
        }

        #results .list-group-item a {
            text-decoration: none;
            color: #333;
            display: block;
        }

        #results .list-group-item .title {
            font-weight: bold;
            font-size: 16px;
            color: #212529;
        }

        #results .list-group-item small {
            color: #6c757d;
            margin-top: 5px;
            display: block;
        }

        #results .list-group-item:hover {
            cursor: pointer;
        }

        #results .list-group-item.active .title {
            color: white;
        }

        #results .list-group-item.active small {
            color: #dfe7f1;
        }

        #flex {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin: 20px;
        }

        ul li {
            list-style: none;
            height: 85px;
        }
        img{
            width: 70%;
        }
        .modal-body{
            text-align: center;
        }
    </style>
</head>

<body>

    <input type="text" id="query" class="col-2" placeholder="검색어 입력">
    <button id="searchBtn" class="btn btn-primary">검색</button>
    <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#exampleModal">
        메뉴추천
    </button>
    <div id="flex">
        <ul id="results" class="list-group">
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
        <div id="map">
        </div>
    </div>
    <button id="find">길찾기</button>

    <!-- 모달 -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">메뉴 추천</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modal-body">
                    <img src="img/recommend/국밥.jpg">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" id="random" class="btn btn-primary">메뉴추천</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let menu = ['갈비탕','국밥','국수','김밥','김치찌개','낚지볶음',
                    '냉면','돈가스','된장찌개','떡볶이','라멘','라면','불고기',
                    '비빔밥','삼겹살','삼계탕','샌드위치','샐러드','스파게티',
                    '오므라이스','육개장','제육','짜장면','짬뽕','치킨','카레',
                    '파스타','편의점도시락','피자','햄버거','백반','골뱅이무침'
                    ]
        const clientId = "KRBOkwddnY_owCDZ__Sa"; // 네이버 개발자 센터에서 발급받은 클라이언트 ID
        const clientSecret = "t0BEV25J14"; // 클라이언트 시크릿

        document.getElementById("searchBtn").addEventListener("click", function () {
            const query = document.getElementById("query").value;
            searchNaver(query);
        });
        document.querySelector("#query").addEventListener("keydown", function (ev) {
            if (ev.key === 'Enter') {
                const query = document.getElementById("query").value;
                searchNaver(query);
            }

        })

        function searchNaver(query) {
            // 검색어 유효성 검사 추가
            if (!query || query.trim() == "") {
                alert("검색어를 입력해주세요!");
                return;
            }
            //https://cors-anywhere.herokuapp.com/corsdemo CORS 우회
            const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
            const apiUrl =
                `https://openapi.naver.com/v1/search/local.json?query=${encodeURIComponent(query)}&display=5&sort=comment`;

            fetch(proxyUrl + apiUrl, {
                    method: "GET",
                    headers: {
                        "X-Naver-Client-Id": clientId,
                        "X-Naver-Client-Secret": clientSecret
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log(data)
                    displayResults(data.items);
                })
                .catch(error => {
                    console.error("검색 실패:", error);
                    alert("CORS 데모 서버");
                });
        }

        function displayResults(items) {
            const resultList = document.getElementById("results");
            resultList.innerHTML = "";
            items.forEach(item => {
                const li = document.createElement("li");
                // 클래스 추가
                li.classList = "list-group-item";
                li.innerHTML =
                    `<a href="#"><span class='title'>${item.title}</span> <small>${item.address}</small></a>`;
                resultList.appendChild(li);
                li.addEventListener("mouseover", function () {
                    li.classList.add("active");
                    li.setAttribute("aria-current", "true");
                })
                li.addEventListener("mouseout", function () {
                    li.classList = "list-group-item";
                    li.setAttribute("aria-current", "false");
                })
                li.addEventListener("click", function () {
                    geocodeAddress(li.lastChild.lastChild.textContent);
                })
            });
            if (items.length == 0) {
                const li = document.createElement("li");
                li.classList = "list-group-item";
                li.innerHTML = `<a href="#"><span class='title'>조회한 값이 없습니다.</span>`;
                resultList.appendChild(li);
            }
            //document.querySelector('#results').style.display = "block"
        }




        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        function geocodeAddress(storeName) {
            naver.maps.Service.geocode({
                query: storeName
            }, function (status, response) {
                if (status !== naver.maps.Service.Status.OK) {
                    return alert('Something wrong!');
                }

                var result = response.v2,
                    items = result.addresses;

                findMap(items[0].x, items[0].y, storeName)

            });
        }

        let schoolLat;
        let schoolLon;
        let destLat;
        let destLon;
        let startName;
        let destName;

        function findMap(x, y, storeName) {
            schoolLat = 35.8690357;
            schoolLon = 128.5932733;
            destLat = Number(y);
            destLon = Number(x);
            startName = "예담직업전문학교";
            destName = storeName;

            // 지도 생성
            const map = new naver.maps.Map("map", {
                center: new naver.maps.LatLng((schoolLat + destLat) / 2, (schoolLon + destLon) / 2),
                zoom: 15
            });

            // 출발지 마커
            const startMarker = new naver.maps.Marker({
                position: new naver.maps.LatLng(schoolLat, schoolLon),
                map: map,
                title: startName
            });

            // 출발지 인포 윈도우 (마커 클릭 시 보이도록 설정)
            const startInfoWindow = new naver.maps.InfoWindow({
                content: `<div style="padding:5px;"><b>${startName}</b></div>`
            });
            naver.maps.Event.addListener(startMarker, "click", function () {
                startInfoWindow.open(map, startMarker);
            });

            // 목적지 마커
            const destMarker = new naver.maps.Marker({
                position: new naver.maps.LatLng(destLat, destLon),
                map: map,
                title: destName
            });

            // 목적지 인포 윈도우 (마커 클릭 시 보이도록 설정)
            const destInfoWindow = new naver.maps.InfoWindow({
                content: `<div style="padding:5px;"><b>${destName}</b></div>`
            });
            naver.maps.Event.addListener(destMarker, "click", function () {
                destInfoWindow.open(map, destMarker);
            });
        }



        document.querySelector('#find').addEventListener('click', function () {
            const encodedStartName = encodeURIComponent(startName);
            const encodedDestName = encodeURIComponent(destName);
            const centerLat = (schoolLat + destLat) / 2;
            const centerLon = (schoolLon + destLon) / 2;
            const zoomLevel = 15;

            const url =
                `https://map.naver.com/v5/directions/${schoolLon},${schoolLat},${encodedStartName},,/${destLon},${destLat},${encodedDestName},,/-/walk?c=${centerLon},${centerLat},${zoomLevel},0,0,0,dh`;

            console.log("네이버 지도 길찾기 URL:", url);
            window.open(url, "_blank"); 
        })
         document.querySelector('#random').addEventListener('click', function () {
            let numberRandom = Math.ceil(Math.random()*51)+50
            
            for(i=0; i<=numberRandom;  i++){
                let menuRandom = Math.ceil(Math.random()*31)
                console.log(menuRandom)
                console.log(menu[menuRandom])
                setTimeout(random,3000)
                function random(){
                 
                 document.querySelector('#modal-body').innerHTML=`<img src="img/recommend/${menu[menuRandom]}.jpg">`
                }
            }
         })
    </script>
</body>

</html>